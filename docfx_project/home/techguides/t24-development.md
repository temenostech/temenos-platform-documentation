# Introduction & Prerequisites #

This developer guide presents the required configurations and the main steps for the following actions:
 - develop new/existent jBC routines and deploy them to your sandbox
 - import/export applications/enquiries/versions from/to your sandbox to/from your local machine
 - extract from the database/load in the database data (.d) files from/to your sandbox to/from your local machine.
 
For this purpose, you need to have access to:
 - Design Studio(locally)
 - T24 libraries(locally)
 - TAFJ (locally)
 - Temenos Sandbox(cloud)
 - Tortoise Git(locally)  - download from [here](https://tortoisegit.org/download/ "Tortoise")
 
A development package (containing Design Studio, T24 libraries and TAFJ) is provided by Temenos  and it is pre-configured in order to be able to introspect T24 application hosted in Temenos Could Development Dev-X.
This package is adapted according to the T24 version of your sandbox and it is provided as a .zip file. After extracting it in your local machine to any location, the bellow folders and files should exist:
![dev package](./images/dev-package.png)  
The development package is pre-configured to be extracted in _C:\TemenosDev_ path. If the package is extracted in another path(Your_DEV_Path), make sure you make the bellow changes to the development package:
 - in _tafj.link file_ from Your_DEV_Path\DesignStudio\dropins folder, update the path variable with the new path to _TAFJ\eclipse_ folder.(make sure you use '/' as separator between folders)
 - in _tafj.properties_ from Your_DEV_Path\TAFJ\conf, update lines 13, 26 and 42 based on Your_DEV_Path.
 - if a project already exists in your DesignStudio workspace, in _Launch T24 Packager (TAFJ).launch_ file from Your_DEV_Path\DesignStudio\workspace\YOUR-project-packager, lines 9, 10 and 11 must be updated accordingly to Your_Path.  

To be able to interrogate the sandbox database, a series of updates must be applied to _tafj.properties_ file from Your_DEV_Path\TAFJ\conf:  
| **Property**  		| Value	|
|-					|-		|
|temn.tafj.jdbc.url		|	jdbc:h2:tcp://**Your_Sandbox_Database_IP**/TAFJDB;MODE=Oracle;TRACE_LEVEL_FILE=0; TRACE_LEVEL_SYSTEM_OUT=0;DB_CLOSE_ON_EXIT=FALSE;FILE_LOCK=NO; IFEXISTS=TRUE;CACHE_SIZE=131072;MVCC=TRUE;LOCK_TIMEOUT=30000   |
|temn.tafj.jdbc.driver	|	org.h2.Driver |
|temn.tafj.jdbc.username|	t24 |
|temn.tafj.jdbc.password|	t24 |
> [!Note]
> In order to get the database IP of your Sandbox, contact TemenosCloud team at <br>TemenosCloud@temenos.com.
 
# Create New Project in Design Studio #
In order to accomplish the development actions presented at the beginning of the guide, you need to create a new project in Design Studio.

* Start Design Studio from _DesignStudio_ folder using **StartDesignStudio.bat** file and choose the default workspace (Your_DEV_Path\DesignStudio\workspace) or any other workspace from your local machine.
* After Design Studio starts, go to **File** > **New** > **Project**.  
* Select **Design Studio Template Project** from **Design Studio** item and click **Next**.  
![design studio template project](./images/ds-template-project.png)
* In the next screen, select **t24-packager-tafj** template from the drop down list and set _tafjHome_, _insertDir_ and _libDir_ parameters according to Your_DEV_Path.  
![tafj package](./images/tafj-packager.png)

> [!Note]
> For **project-name** parameter, make sure you use small letters(ft-sample as per above example) and for **component-name** parameter, make sure you start the name with capital letters(FT-Sample as per above example).

* Click **Finish** to create the project and 4 modules will be created, as per bellow picture.  
  -> ft-sample-**data-code**: holding basic routines and data files.  
  -> ft-sample-**models**: holding Design Studio models(applications, enquiries, versions) that can be imported/exported from/to your sandbox.  
  -> ft-sample-**models-gen**: holding files generated by Design Studio from the ft-sample-**models** project.   
  -> ft-sample-**packager**: holding the launcher for creating a T24 package that can be deployed to your sandbox.
![created projects](./images/created-projects.png)

# Create New T24 Server in Design Studio #
A T24 Server is required in Design Studio to be able to import/export applications/enquiries/versions from/to your sandbox. Follow next steps to create and configure a T24 server:
* On servers tab, click right and select **Add New T24 Server**.  
![add server](./images/add-server.png)
* A new screen is open. Type a **name** for the server(make sure it includes '-server' string) and click **Next**.  
![project name](./images/project-name.png)  
* Choose connection type as **T24 Server-Web Service** and click **Finish**.  
![connection type](./images/connection-type.png)  
* After the server is created, the _server.properties_ must be updated according to your sandox details:  
-> In _T24 User (deployment only)_ section, **2 users** that you use to connect to your T24 sandbox must be introduced.  
-> In _WebService (TAFJ) Connection_ section, **Secured box** must be checked, **Protocol** must be set to _ws_ value, **Hostname** must be set according to the hostname of your sandbox, **Port** must be set to _443_ value and **Context** to _axis2_ value.  
![server properties](./images/server-properties.png)  
-> To get the hostname of your sandbox, log-in to your organisation in PaaS Portal, go to your enviroment page and click on the **GO TO Application** Endpoint for the T24 application. The BrowserWeb page of your sandbox is opened and from the URL of this page, you must select the part between _https://_ and _/BrowserWeb/servlet/BrowserServlet_.
![hostname](./images/hostname.png)

# Toggle Project to TAFJ project nature #
The **Toggle TAFJ project nature** action must be performed in order to be able to develop, compile and package jBC routines and to interrogate your sandbox database.  
* Right click on **data-code** module and choose **Toggle TAFJ project nature**.  
![tafj toggle 1](./images/tafj-toggle-1.png)  
* In the next screen, import _tafj_properties_ from Your_DEV_Path/TAFJ/conf folder, choose TAFJ_HOME as Your_DEV_Path/TAFJ folder and click **Next**. In the bellow picture, DEV_Path is set to C:\TemenosDEV.
![tafj toggle 2](./images/tafj-toggle-2.png)  
* In the next screens, click **Next** and **Finish**.  
![tafj toggle 3](./images/tafj-toggle-3.png)  
* In the end, **data-code** module should be toggled.  
![tafj toggle 4](./images/tafj-toggle-4.png)  
* A .properties file was created for your project in Your_DEV_Path/TAFJ/conf folder.  
![tafj toggle 5](./images/tafj-toggle-5.png)  

> [!Note]
> If TAFJ properties for your project must be updated, make sure you update the .properties related to your project from Your_DEV_Path/TAFJ/conf folder.

# jBC Routines Development #
jBC routines are developed in the **data-code** module which must be toggled to TAFJ project nature by following next steps.  
* In order to create a new jBC routine, expand **data-code** module, go to src->Source->Private, right click on project name (FT_Sample in the above picture), select **New** and then **New T24 routine / component / testcase**.
![add routine](./images/add-routine.png)  
* On next screen, type the name of the routine and click **Finish**.  
![add routine name](./images/add-routine-1.png)
* The new routine is created.  
![add routine created](./images/add-routine-2.png)

# Create a T24 package based on your project #
In order to deploy your developed routines in the sandbox, a T24 package must be created.
 - Go to **packager** module in Design Studio workspace, right click on **Launch T24 Packager (TAFJ).launch** and choose **Run As** > **Launch T24 Packager (TAFJ)**.
![build-project](./images/build-project.png)

 - **Wait** for successfull build for the project.

![build success](./images/build-success-final.png)

 - Check where the **package** was generated.

![check build success](./images/check-build-success.png)

# Deploy a T24 package to Sandbox #

> [!Note]
> Make sure you cloned in your local machine the GitLab repository of your sandbox.

* Copy the generated package into the **packages** folder of the cloned GitLab repository from your local machine:  
![packages](./images/packages.png)  
* If the package is a new file in the repository, the package must be first added to the repository:  
![tortoise add](./images/tortoise-add.png)  
* A screen will appear saying that the file was added. Press **Commit**:  
![tortoise commit](./images/tortoise-commit.png)  
* A new screen will appear. Insert a comment in the upper window and then choose **Commit**.  
![tortoise commit and push](./images/commit-push.png)  
* A new screen will appear and choose **Push**.  
![tortoise push after commit](./images/push_after_commit.png)  
* A new screen will appear and choose **OK**.  
![tortoise ok after push](./images/ok_after_push.png)  
* A success message should be displayed. Press **Close**.
![tortoise success after push](./images/success_after_push.png)  

# Check jBC routines deployment to Sandbox #

* Log-in to your organisation in PaaS Portal, go to your enviroment page and click on the **Monitor Application** Endpoint for the T24 application.  
![monitor application](./images/monitor-application.png)  
* The TAFJEE page is opened. Click **tShow** to check if your developed routines were deployed in your sandbox. Details like the compilation date or the jar that contains the class of those routines can be checked.  
![monitor application](./images/monitor-application-tshow.png)  
* In the next screen, input your routine name and click **Submit**.  
![monitor application](./images/monitor-application-submit.png)  
* In the next screen, the details of your routine can be seen.  
![monitor application](./images/monitor-application-result.png)  

# Import T24 Applications, Enquiries and Versions #

> [!Note]
> In order to import Applications/Enquiries/Versions from your sandbox to your local machine, make sure you have a T24-server created and configured in Design Studio.

* Go to Servers tab, right click on your server state and change state to **active**.
![t24 connection](./images/t24-connection.png)  
* State should become active:  
![active server](./images/active-server.png)  

> [!Note]
> The following example is about importing Enquiries from your sandbox to your local machine. The same steps can be aplied for Applications and Versions.  

* After the T24-server is active, right click on the **models** module and choose **Import**:  
![import enquiries 1](./images/import_enquiries_1.png)
* Expand **Design Studio** item, choose **Import T24 Enquiries** and click on **Next** button. (you have to wait until the list of enquiries is fetched from the sandbox database).  
![import enquiries 2](./images/import_enquiries_2.png)
* Select from this list which enquiry you want to import from the sandbox to your local machine and click **Next**.  
![import enquiries 3](./images/import_enquiries_3.png)
* Choose where to import the enquiry(**Models** folder from **models** module) and click **Finish**(wait until the operation is completed).  
![import enquiries 4](./images/import_enquiries_4.png)
* A successful message will be displayed at the end and the enquiry will be saved in your local machine.  
![import enquiries 5](./images/import_enquiries_5.png)

# Export T24 Applications, Enquiries and Versions #

> [!Note]
> The following example is about exporting Enquiries from your local machine to your sandbox. The same steps can be aplied for Applications and Versions.   

> [!Note]
> Make sure your T24 server is set to **active**.

* Right click on the **models** module and choose **Design Studio** -> **Generate Code**:  
![export enquiries 1](./images/export_enquiries_1.png)  
* A message should be displayed saying that the enquiry was successfully modified.
![export enquiries 2](./images/export_enquiries_2.png)  

# Data (.d) files #

A data(.d) file represents a details viewer of a record from the database. A data file has 2 columns:  
-> first column contains the unique number of all table fields of the record;  
-> second column contains the values for all table fields of the record.  
![data files 1](./images/data_files_1.png)

> [!Note]
> Assuming that your **date-code** module is toggled to TAFJ project nature, make sure you update the .properties file related to your project from Your_DEV_Path/TAFJ/conf folder with the database IP of your sandbox.

Before starting to extract/load data files from/to your sandbox database, you must login to TAFJ-DBTools.  
-> Right click on your **data-code** module and select **DBTools login**.
![extract data dbtools 1](./images/extract_data_dbtools_1.png)  
-> A wizard will appear in which you must type the DBTools credentials(which can be found in Add_DBTools_User.bat file from Your_DEV_Path) and click **Finish**.
![extract data dbtools 2](./images/extract_data_dbtools_2.png)  

## Extract data files from the database ##
* Expand **data-code** module, go to src, right click on **Data** and select **Extract from the database**.  
![extract data 1](./images/extract_data_1.png)  
* The bellow wizard will appear. Make sure the URL of the Database contains the correct database IP of your sandbox. Otherwise, you have update your .properties file related to your project from Your_DEV_Path/TAFJ/conf folder.
![extract data 2](./images/extract_data_2.png)  
* Type the Table Name and Record ID and click **Finish**.  
![extract data 3](./images/extract_data_3.png)  
* Check the console log to see if the data files was extracted.
![extract data 4](./images/extract_data_4.png)  

## Load data files in the database ##
* Right click on your data file and select **Load in the database**.  
![load data 1](./images/load_data_1.png)  
* The bellow wizard will appear and click **Finish**. Make sure the URL of the Database contains the correct database IP of your sandbox. Otherwise, you have update your .properties file related to your project from Your_DEV_Path/TAFJ/conf folder.
![extract data 2](./images/load_data_2.png)  
* A success message should be displayed in the console.  
![extract data 3](./images/load_data_3.png)  
